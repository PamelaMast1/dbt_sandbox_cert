version: 2

models:
  - name: workout
    description: "Curated workout facts built from stg_workout."
    deprecation_date: 2999-01-01 00:00:00.00+00:00
    tests:
      - dbt_utils.unique_combination_of_columns:
          arguments: 
            combination_of_columns:
              - workout_date
              - fitness_discipline
            config:
              severity: warn
    columns:
      - name: workout_id
        description: "{{ doc('workout_id') }}"
        tests:
          - not_null
          - unique
          - relationships:
              arguments:
                to: ref('stg_workout')
                field: workout_id
      - name: target_name
        description: "Name of the target environment - specified in profiles.yml"
      - name: dbt_environment_name
        description: "Name of the target environment - specified from the enviroment vars"
      - name: target.database
        description: >
          The database name for the current dbt target. This is the database that
          dbt will create objects in for this run (e.g. your dev or prod database).

      - name: target.schema
        description: >
          The schema name for the current dbt target. dbt uses this to decide which
          schema to build models into (often different per environment, like dev vs prod).

      - name: target.profile_name
        description: >
          The name of the active dbt profile being used for this run. This ties back
          to the connection configuration in profiles.yml or the dbt Cloud environment.

      - name: dbt_run_started_at
        description: "Time the dbt run started"

      - name: dbt_invocation_id
        description: "dbt unique id for the run."

      - name: workout_timestamp
        description: "{{ doc('workout_timestamp') }}"
        tests:
          - not_null

      - name: length_minutes
        description: "{{ doc('length_minutes') }}"
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              arguments:
                expression: ">=0"
      - name: class_title
        description: "{{ doc('class_title') }}"

      - name: total_output
        description: "{{ doc('total_output') }}"
        tests:
          - dbt_utils.expression_is_true:
              arguments:
                expression: ">=0"
      - name: avg_watts
        description: "Average power in watts (if applicable)."
        tests:
          - dbt_utils.expression_is_true:
              arguments:
                expression: ">=0"
      - name: distance_km
        description: "Distance covered in kilometers (if applicable)."
        tests:
          - dbt_utils.expression_is_true:
              arguments:
                expression: ">=0"
      - name: calories_burned
        description: "Estimated calories burned."
        tests:
          - dbt_utils.expression_is_true:
              arguments:
                expression: ">=0"
      - name: avg_heartrate_bpm
        description: "Average heart rate in beats per minute."
        tests:
          - dbt_utils.expression_is_true:
              arguments:
                expression: ">=0"
      - name: fitness_discipline
        description: "High-level workout type/discipline (e.g., Cycling, Running)."

      - name: intensity_band
        description: "Banding based on output_per_min"
        tests:
          - not_null
          - accepted_values:
              arguments:
                values: ['Low', 'Moderate', 'High', 'n/a']

