version: 2

models:
  - name: workout
    description: "Curated workout facts built from stg_workout."
    tests:
      - dbt_utils.unique_combination_of_columns:
          arguments: 
            combination_of_columns:
              - workout_date
              - fitness_discipline
    columns:
      - name: workout_id
        description: "{{ doc('workout_id') }}"
        tests:
          - not_null
          - unique
          - relationships:
              arguments:
                to: ref('stg_workout')
                field: workout_id
      - name: workout_timestamp
        description: "{{ doc('workout_timestamp') }}"
        tests:
          - not_null

      - name: length_minutes
        description: "{{ doc('length_minutes') }}"
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              arguments:
                expression: ">=0"
      - name: class_title
        description: "{{ doc('class_title') }}"

      - name: total_output
        description: "{{ doc('total_output') }}"
        tests:
          - dbt_utils.expression_is_true:
              arguments:
                expression: ">=0"
      - name: avg_watts
        description: "Average power in watts (if applicable)."
        tests:
          - dbt_utils.expression_is_true:
              arguments:
                expression: ">=0"
      - name: distance_km
        description: "Distance covered in kilometers (if applicable)."
        tests:
          - dbt_utils.expression_is_true:
              arguments:
                expression: ">=0"
      - name: calories_burned
        description: "Estimated calories burned."
        tests:
          - dbt_utils.expression_is_true:
              arguments:
                expression: ">=0"
      - name: avg_heartrate_bpm
        description: "Average heart rate in beats per minute."
        tests:
          - dbt_utils.expression_is_true:
              arguments:
                expression: ">=0"
      - name: fitness_discipline
        description: "High-level workout type/discipline (e.g., Cycling, Running)."

      - name: intensity_band
        description: "Banding based on output_per_min"
        tests:
          - not_null
          - accepted_values:
              values: ['Low', 'Moderate', 'High', 'n/a']

